<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ync.intranet.mapper.LeaveRequestIntranetMapper">

    <resultMap id="LeaveRequestIntranetResultMap" type="com.ync.intranet.domain.LeaveRequestIntranet">
        <id property="id" column="id"/>
        <result property="documentId" column="document_id"/>
        <result property="leaveType" column="leave_type"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="leaveDays" column="leave_days"/>
        <result property="reason" column="reason"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <!-- ID로 휴가 신청 조회 -->
    <select id="findById" resultMap="LeaveRequestIntranetResultMap">
        SELECT *
        FROM leave_requests_intranet
        WHERE id = #{id}
    </select>

    <!-- 문서 ID로 휴가 신청 조회 -->
    <select id="findByDocumentId" resultMap="LeaveRequestIntranetResultMap">
        SELECT *
        FROM leave_requests_intranet
        WHERE document_id = #{documentId}
    </select>

    <!-- 휴가 유형별 조회 -->
    <select id="findByLeaveType" resultMap="LeaveRequestIntranetResultMap">
        SELECT *
        FROM leave_requests_intranet
        WHERE leave_type = #{leaveType}
        ORDER BY start_date DESC
    </select>

    <!-- 기간별 휴가 조회 -->
    <select id="findByDateRange" resultMap="LeaveRequestIntranetResultMap">
        SELECT *
        FROM leave_requests_intranet
        WHERE start_date &lt;= #{endDate}
          AND end_date &gt;= #{startDate}
        ORDER BY start_date
    </select>

    <!-- 전체 휴가 신청 조회 -->
    <select id="findAll" resultMap="LeaveRequestIntranetResultMap">
        SELECT *
        FROM leave_requests_intranet
        ORDER BY created_at DESC
    </select>

    <!-- 휴가 신청 등록 -->
    <insert id="insert" parameterType="com.ync.intranet.domain.LeaveRequestIntranet">
        <selectKey keyProperty="id" resultType="long" order="BEFORE">
            SELECT leave_requests_intranet_seq.NEXTVAL FROM dual
        </selectKey>
        INSERT INTO leave_requests_intranet (
            id, document_id, leave_type, start_date, end_date,
            start_time, end_time, leave_days, reason, created_at
        )
        VALUES (
            #{id}, #{documentId}, #{leaveType}, #{startDate}, #{endDate},
            #{startTime}, #{endTime}, #{leaveDays}, #{reason}, CURRENT_TIMESTAMP
        )
    </insert>

    <!-- 휴가 신청 수정 -->
    <update id="update" parameterType="com.ync.intranet.domain.LeaveRequestIntranet">
        UPDATE leave_requests_intranet
        SET leave_type = #{leaveType},
            start_date = #{startDate},
            end_date = #{endDate},
            start_time = #{startTime},
            end_time = #{endTime},
            leave_days = #{leaveDays},
            reason = #{reason}
        WHERE id = #{id}
    </update>

    <!-- 휴가 신청 삭제 -->
    <delete id="deleteById">
        DELETE FROM leave_requests_intranet WHERE id = #{id}
    </delete>

    <!-- 문서 ID로 휴가 신청 삭제 -->
    <delete id="deleteByDocumentId">
        DELETE FROM leave_requests_intranet WHERE document_id = #{documentId}
    </delete>

</mapper>
