<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ì •/íœ´ê°€ ê´€ë¦¬ - Y&C Intranet</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' fill='%23ffffff' rx='8'/%3E%3Ctext x='32' y='46' text-anchor='middle' font-size='40' font-weight='900' font-family='Arial,sans-serif' fill='%23667eea'%3EY%3C/text%3E%3C/svg%3E"/>

    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet"/>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f7fafc;
            min-height: 100vh;
        }

        .header {
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            color: #667eea;
            font-size: 24px;
            font-weight: 700;
            cursor: pointer;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .btn-logout {
            padding: 8px 16px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .page-header {
            background: white;
            border-radius: 16px;
            padding: 24px 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-header h2 {
            color: #2d3748;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .page-header h2::before {
            content: "ğŸ“…";
            font-size: 32px;
        }

        .header-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .calendar-container {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
        }

        /* FullCalendar ìŠ¤íƒ€ì¼ */
        .fc {
            --fc-border-color: #e2e8f0;
            --fc-today-bg-color: rgba(102, 126, 234, 0.1);
        }

        .fc .fc-button {
            border-radius: 8px;
            font-weight: 700;
            text-transform: none;
            padding: 8px 16px;
            background: white;
            border: 2px solid #e2e8f0;
            color: #2d3748;
        }

        .fc .fc-button-primary:not(:disabled).fc-button-active {
            color: #2d3748;
        }

        /* FullCalendar ë²„íŠ¼ íš¨ê³¼ ì œê±° */
        .fc .fc-button-primary:hover {
            background-color: white !important;
            border-color: #e2e8f0 !important;
            color: #2d3748 !important;
        }

        .fc .fc-button-primary:focus {
            box-shadow: none !important;
        }

        .fc .fc-button:focus {
            box-shadow: none !important;
            outline: none !important;
        }

        .fc .fc-button-primary:not(:disabled).fc-button-active,
        .fc .fc-button-primary:not(:disabled):active {
            background-color: white !important;
            border-color: #e2e8f0 !important;
            color: #2d3748 !important;
        }

        .fc-event {
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 12px;
        }

        /* ì´ë²¤íŠ¸ ì œëª© ë§ì¤„ì„ ë° íˆ´íŒ */
        .fc-event-title {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .fc-event:hover .fc-event-title {
            overflow: visible;
            white-space: normal;
            word-break: break-word;
        }

        .fc-event.event-vacation {
            background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
        }

        .fc-event.event-half-day {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
        }

        .fc-event.event-business {
            background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
        }

        .fc-event.event-meeting {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
        }

        .legend {
            background: white;
            border-radius: 12px;
            padding: 20px 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: flex;
            gap: 16px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid #edf2f7;
        }

        .btn-cancel {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-cancel:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:active {
            transform: translateY(0);
        }

        /* ê²°ì¬ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .approval-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .approval-modal.show {
            display: flex;
        }

        .approval-modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .approval-modal-header {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e2e8f0;
        }

        .approval-modal-body {
            margin-bottom: 24px;
        }

        .approval-info-row {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid #f7fafc;
        }

        .approval-info-label {
            flex: 0 0 120px;
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
        }

        .approval-info-value {
            flex: 1;
            color: #2d3748;
            font-size: 14px;
        }

        .approval-content-box {
            background: #f7fafc;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            color: #2d3748;
            font-size: 14px;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
        }

        .form-group-modal {
            margin-bottom: 20px;
        }

        .form-group-modal label {
            display: block;
            color: #2d3748;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group-modal textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }

        .form-group-modal textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .approval-modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
        }

        .btn-modal-cancel {
            padding: 12px 24px;
            background: #e2e8f0;
            color: #2d3748;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-modal-cancel:hover {
            background: #cbd5e0;
        }

        .btn-modal-approve {
            padding: 12px 24px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-modal-approve:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-modal-reject {
            padding: 12px 24px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-modal-reject:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <h1 onclick="location.href='/intranet-main.html'">Y&C Intranet</h1>
        </div>
        <div class="header-right">
            <div class="user-avatar" id="userAvatar">U</div>
            <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </header>

    <div class="container" style="display: flex; gap: 24px;">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside style="width: 320px; flex-shrink: 0;">
            <!-- í•„í„° -->
            <div class="sidebar-card" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 16px; color: #2d3748;">ğŸ” í•„í„°</h3>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 6px;">ë³¸ë¶€</label>
                        <select id="filterDivision" onchange="handleDivisionChange()" style="width: 100%; padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 13px;">
                            <option value="">ì „ì²´</option>
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 6px;">ë¶€ì„œ</label>
                        <select id="filterDepartment" onchange="handleDepartmentChange()" style="width: 100%; padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 13px;">
                            <option value="">ì „ì²´</option>
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 6px;">êµ¬ì„±ì›</label>
                        <select id="filterMember" onchange="console.log('[í•„í„°] filterMember ë³€ê²½ë¨'); applyFilters()" style="width: 100%; padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 13px;">
                            <option value="">ì „ì²´</option>
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button onclick="showMySchedule()" style="padding: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 700; cursor: pointer;">ë‚´ ì¼ì • ë³´ê¸°</button>
                        <button onclick="resetFilters()" style="padding: 8px; background: #f7fafc; color: #2d3748; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-weight: 700; cursor: pointer;">í•„í„° ì´ˆê¸°í™”</button>
                    </div>
                </div>
            </div>

            <!-- ë‚´ íœ´ê°€ í˜„í™© -->
            <div class="sidebar-card" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 16px; color: #2d3748;">ğŸ“Š ë‚´ íœ´ê°€ í˜„í™©</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                    <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #dbeafe, #e0f2fe); border-radius: 8px;">
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 4px;">ë¶€ì—¬</div>
                        <div style="font-size: 20px; font-weight: 800; color: #2d3748;" id="leaveGranted">15</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #fce7f3, #fce7f3); border-radius: 8px;">
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 4px;">ì‚¬ìš©</div>
                        <div style="font-size: 20px; font-weight: 800; color: #2d3748;" id="leaveUsed">0</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #d1fae5, #d1fae5); border-radius: 8px;">
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 4px;">ì”ì—¬</div>
                        <div style="font-size: 20px; font-weight: 800; color: #2d3748;" id="leaveRemaining">15</div>
                    </div>
                </div>
            </div>

            <!-- ê²°ì¬ ëŒ€ê¸° -->
            <div class="sidebar-card" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 16px; color: #2d3748;">
                    ğŸ“‹ ê²°ì¬ ëŒ€ê¸°
                    <span id="approvalBadge" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; font-size: 12px; font-weight: 800; padding: 2px 8px; border-radius: 12px; margin-left: 8px;">0</span>
                </h3>
                <div id="approvalList">
                    <div style="text-align: center; padding: 20px; color: #a0aec0; font-size: 13px;">ê²°ì¬ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>

            <!-- ë‚´ ì¼ì • ëª©ë¡ -->
            <div class="sidebar-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); max-height: 500px; overflow-y: auto;">
                <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 16px; color: #2d3748;">ğŸ“ ë‚´ ì¼ì •</h3>
                <div id="myScheduleList">
                    <div style="text-align: center; padding: 20px; color: #a0aec0; font-size: 13px;">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>
        </aside>

        <!-- ë©”ì¸ ì˜ì—­ -->
        <div style="flex: 1; min-width: 0;">
            <div class="page-header">
                <h2>ì¼ì • ë° íœ´ê°€ ê´€ë¦¬</h2>
                <div class="header-buttons">
                    <button class="btn btn-success" onclick="openEventModal()">+ ìƒˆ ì¼ì •</button>
                </div>
            </div>

            <div class="calendar-container">
                <div id="calendar"></div>
            </div>

            <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);"></div>
                <span>ì—°ì°¨</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);"></div>
                <span>ë°˜ì°¨</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);"></div>
                <span>ì¶œì¥</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%);"></div>
                <span>íšŒì˜</span>
            </div>
        </div>
    </div>

    <!-- ì¼ì • ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeaderTitle">ì¼ì • ì¶”ê°€</div>
            <form id="eventForm">
                <div class="form-group">
                    <label>ì¼ì • ìœ í˜•</label>
                    <select id="eventType" required onchange="handleEventTypeChange()">
                        <option value="VACATION">ì—°ì°¨</option>
                        <option value="HALF_DAY">ë°˜ì°¨</option>
                        <option value="BUSINESS_TRIP">ì¶œì¥</option>
                        <option value="MEETING">íšŒì˜</option>
                    </select>
                </div>

                <div class="form-group" id="halfDayTypeGroup" style="display: none;">
                    <label>ë°˜ì°¨ êµ¬ë¶„</label>
                    <select id="halfDayType">
                        <option value="AM">ì˜¤ì „ ë°˜ì°¨ (09:00-13:00)</option>
                        <option value="PM">ì˜¤í›„ ë°˜ì°¨ (13:00-18:00)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ì œëª©</label>
                    <input type="text" id="eventTitle" required placeholder="ì¼ì • ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ì‹œì‘ì¼</label>
                        <input type="date" id="eventStartDate" required onchange="handleStartDateChange()">
                    </div>
                    <div class="form-group">
                        <label>ì¢…ë£Œì¼</label>
                        <input type="date" id="eventEndDate" required>
                    </div>
                </div>

                <div class="form-row" id="timeGroup" style="display: none;">
                    <div class="form-group">
                        <label>ì‹œì‘ ì‹œê°„</label>
                        <input type="time" id="eventStartTime">
                    </div>
                    <div class="form-group">
                        <label>ì¢…ë£Œ ì‹œê°„</label>
                        <input type="time" id="eventEndTime">
                    </div>
                </div>

                <div class="form-group" id="daysUsedGroup" style="display: none;">
                    <label>ì‚¬ìš© ì¼ìˆ˜</label>
                    <input type="number" id="eventDaysUsed" step="0.5" min="0" placeholder="ì˜ˆ: 1, 0.5">
                </div>

                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="eventDescription" placeholder="ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="form-group" id="approverGroup" style="display: none;">
                    <label>ê²°ì¬ ëŒ€ìƒì</label>
                    <select id="approverId">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>

                <!-- ê²°ì¬ ìƒíƒœ í‘œì‹œ ì˜ì—­ (ìˆ˜ì • ëª¨ë“œì—ë§Œ í‘œì‹œ) -->
                <div id="approvalStatusSection" style="display: none; margin-top: 20px; padding: 16px; background: #f7fafc; border-radius: 8px;">
                    <div style="font-weight: 600; color: #2d3748; margin-bottom: 12px;">ê²°ì¬ ì§„í–‰ ìƒí™©</div>
                    <div id="approvalStatusContent"></div>
                </div>

                <div class="modal-footer">
                    <button type="button" id="btnDeleteEvent" class="btn btn-danger" style="display: none; margin-right: auto;">ì‚­ì œ</button>
                    <button type="button" id="btnCancelRequest" class="btn btn-danger" style="display: none; margin-right: auto;">ì·¨ì†Œ ì‹ ì²­</button>
                    <button type="button" class="btn btn-cancel" onclick="closeEventModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-success">ì €ì¥ ë° ê²°ì¬ìš”ì²­</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <script>
        let calendar;
        let currentUser;

        function checkLogin() {
            const user = sessionStorage.getItem('user');
            if (!user) {
                window.location.href = '/intranet-login.html';
                return null;
            }
            return JSON.parse(user);
        }

        function displayUserInfo() {
            currentUser = checkLogin();
            if (!currentUser) return;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);
        }

        // ëŒ€í•œë¯¼êµ­ ê³µíœ´ì¼ ë°ì´í„° (2024-2026)
        const koreanHolidays = {
            '2024-01-01': 'ì‹ ì •',
            '2024-02-09': 'ì„¤ë‚  ì—°íœ´',
            '2024-02-10': 'ì„¤ë‚ ',
            '2024-02-11': 'ì„¤ë‚  ì—°íœ´',
            '2024-02-12': 'ëŒ€ì²´ê³µíœ´ì¼',
            '2024-03-01': 'ì‚¼ì¼ì ˆ',
            '2024-04-10': 'êµ­íšŒì˜ì› ì„ ê±°',
            '2024-05-05': 'ì–´ë¦°ì´ë‚ ',
            '2024-05-06': 'ëŒ€ì²´ê³µíœ´ì¼',
            '2024-05-15': 'ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ ',
            '2024-06-06': 'í˜„ì¶©ì¼',
            '2024-08-15': 'ê´‘ë³µì ˆ',
            '2024-09-16': 'ì¶”ì„ ì—°íœ´',
            '2024-09-17': 'ì¶”ì„',
            '2024-09-18': 'ì¶”ì„ ì—°íœ´',
            '2024-10-03': 'ê°œì²œì ˆ',
            '2024-10-09': 'í•œê¸€ë‚ ',
            '2024-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤',
            '2025-01-01': 'ì‹ ì •',
            '2025-01-28': 'ì„¤ë‚  ì—°íœ´',
            '2025-01-29': 'ì„¤ë‚ ',
            '2025-01-30': 'ì„¤ë‚  ì—°íœ´',
            '2025-03-01': 'ì‚¼ì¼ì ˆ',
            '2025-03-03': 'ëŒ€ì²´ê³µíœ´ì¼',
            '2025-05-05': 'ì–´ë¦°ì´ë‚ ',
            '2025-05-06': 'ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ ',
            '2025-06-06': 'í˜„ì¶©ì¼',
            '2025-08-15': 'ê´‘ë³µì ˆ',
            '2025-10-03': 'ê°œì²œì ˆ',
            '2025-10-05': 'ì¶”ì„ ì—°íœ´',
            '2025-10-06': 'ì¶”ì„',
            '2025-10-07': 'ì¶”ì„ ì—°íœ´',
            '2025-10-08': 'ëŒ€ì²´ê³µíœ´ì¼',
            '2025-10-09': 'í•œê¸€ë‚ ',
            '2025-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤',
            '2026-01-01': 'ì‹ ì •',
            '2026-02-16': 'ì„¤ë‚  ì—°íœ´',
            '2026-02-17': 'ì„¤ë‚ ',
            '2026-02-18': 'ì„¤ë‚  ì—°íœ´',
            '2026-03-01': 'ì‚¼ì¼ì ˆ',
            '2026-03-03': 'ëŒ€ì²´ê³µíœ´ì¼',
            '2026-05-05': 'ì–´ë¦°ì´ë‚ ',
            '2026-05-25': 'ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ ',
            '2026-06-06': 'í˜„ì¶©ì¼',
            '2026-08-15': 'ê´‘ë³µì ˆ',
            '2026-09-24': 'ì¶”ì„ ì—°íœ´',
            '2026-09-25': 'ì¶”ì„',
            '2026-09-26': 'ì¶”ì„ ì—°íœ´',
            '2026-10-03': 'ê°œì²œì ˆ',
            '2026-10-05': 'ëŒ€ì²´ê³µíœ´ì¼',
            '2026-10-09': 'í•œê¸€ë‚ ',
            '2026-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤'
        };

        function isHoliday(date) {
            const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            return koreanHolidays[dateStr];
        }

        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                buttonText: {
                    today: 'ì˜¤ëŠ˜',
                    month: 'ì›”',
                    week: 'ì£¼',
                    list: 'ëª©ë¡'
                },
                // ì‹œê°„ ì„¤ì • (ì£¼ íƒ­ìš©)
                slotMinTime: '08:00:00',
                slotMaxTime: '20:00:00',
                slotDuration: '00:30:00',
                slotLabelInterval: '01:00',
                slotLabelFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    meridiem: false,
                    hour12: false
                },
                // ì„ íƒ ê¸°ëŠ¥
                selectable: true,
                selectMirror: true,
                selectOverlap: true,
                select: function(info) {
                    // ì„ íƒí•œ ë‚ ì§œ/ì‹œê°„ ì •ë³´ë¡œ ëª¨ë‹¬ ì—´ê¸°
                    const start = info.start;
                    let end = info.end;

                    // ë‚ ì§œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ë¡œì»¬ ì‹œê°„ëŒ€ ìœ ì§€)
                    const formatDate = (date) => {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}-${month}-${day}`;
                    };

                    let startDate = formatDate(start);
                    let endDate;

                    // allDay ì´ë²¤íŠ¸ì¸ ê²½ìš°, FullCalendarì˜ endëŠ” exclusive (ë‹¤ìŒë‚  00:00)
                    // ë”°ë¼ì„œ ì‹¤ì œ ì¢…ë£Œì¼ì€ end - 1ì¼
                    if (info.allDay) {
                        const actualEnd = new Date(end);
                        actualEnd.setDate(actualEnd.getDate() - 1);
                        endDate = formatDate(actualEnd);
                    } else {
                        endDate = formatDate(end);
                    }

                    console.log('[ë‹¬ë ¥ ì„ íƒ]', {
                        ì›ë³¸_start: start,
                        ì›ë³¸_end: end,
                        allDay: info.allDay,
                        ìµœì¢…_startDate: startDate,
                        ìµœì¢…_endDate: endDate
                    });

                    // ì‹œê°„ ì •ë³´ ì¶”ì¶œ (allDayê°€ ì•„ë‹ ë•Œ)
                    if (!info.allDay) {
                        const startTime = start.toTimeString().substring(0, 5);
                        const endTime = end.toTimeString().substring(0, 5);
                        openEventModal(startDate, endDate, startTime, endTime);
                    } else {
                        openEventModal(startDate, endDate);
                    }

                    calendar.unselect();
                },
                // ì´ë²¤íŠ¸ í´ë¦­
                eventClick: function(info) {
                    showEventDetail(info.event);
                },
                // ì´ë²¤íŠ¸ í‘œì‹œ
                events: function(fetchInfo, successCallback, failureCallback) {
                    loadEvents(fetchInfo)
                        .then(events => {
                            console.log('[ë‹¬ë ¥] successCallback í˜¸ì¶œ, ì´ë²¤íŠ¸ ê°œìˆ˜:', events.length);
                            successCallback(events);
                        })
                        .catch(error => {
                            console.error('[ë‹¬ë ¥] ì´ë²¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                            failureCallback(error);
                        });
                },
                eventTimeFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    meridiem: false,
                    hour12: false
                },
                // ì´ë²¤íŠ¸ í‘œì‹œ ê°œì„ 
                displayEventTime: false, // ê¸°ë³¸ ì‹œê°„ í‘œì‹œ ë„ê¸° (ì»¤ìŠ¤í…€ìœ¼ë¡œ í‘œì‹œ)
                displayEventEnd: false,
                // ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë Œë”ë§ (ì‹œê°„ì„ ì•„ì´ì½˜ ë‹¤ìŒì— í‘œì‹œ)
                eventContent: function(arg) {
                    const event = arg.event;
                    const timeText = arg.timeText;

                    // ì´ë²¤íŠ¸ ìœ í˜•ë³„ ì•„ì´ì½˜
                    let icon = '';
                    if (event.extendedProps.scheduleType === 'VACATION') {
                        icon = 'ğŸŒ´';
                    } else if (event.extendedProps.scheduleType === 'HALF_DAY') {
                        icon = 'â°';
                    } else if (event.extendedProps.scheduleType === 'MEETING') {
                        icon = 'ğŸ“„';
                    } else if (event.extendedProps.scheduleType === 'BUSINESS_TRIP') {
                        icon = 'ğŸ’¼';
                    }

                    // ì‹œê°„ì´ ìˆëŠ” ê²½ìš°: ì•„ì´ì½˜ ì‹œê°„ ì œëª©
                    // ì‹œê°„ì´ ì—†ëŠ” ê²½ìš°: ì•„ì´ì½˜ ì œëª©
                    let displayText = '';
                    if (timeText) {
                        displayText = `${icon} ${timeText} ${event.title.replace(/^[ğŸŒ´â°ğŸ“„ğŸ’¼]\s*/, '')}`;
                    } else {
                        displayText = event.title;
                    }

                    return { html: `<div class="fc-event-main-frame"><div class="fc-event-title-container"><div class="fc-event-title">${displayText}</div></div></div>` };
                },
                // ì£¼ íƒ­ ì„¤ì •
                allDaySlot: true,
                nowIndicator: true,
                scrollTime: '09:00:00',
                // ë†’ì´ ìë™ ì¡°ì •
                height: 'auto',
                contentHeight: 600,
                // ë‚ ì§œ ì…€ ìŠ¤íƒ€ì¼ë§ (í† ìš”ì¼/ì¼ìš”ì¼/ê³µíœ´ì¼)
                dayCellDidMount: function(info) {
                    const date = info.date;
                    const dayOfWeek = date.getDay();
                    const holiday = isHoliday(date);
                    const dayNumber = info.el.querySelector('.fc-daygrid-day-number');
                    const dayTop = info.el.querySelector('.fc-daygrid-day-top');

                    if (dayNumber) {
                        // ê³µíœ´ì¼ (ë¹¨ê°„ìƒ‰)
                        if (holiday) {
                            dayNumber.style.color = '#e53e3e';
                            dayNumber.style.fontWeight = '700';

                            // ê³µíœ´ì¼ ì´ë¦„ í‘œì‹œ
                            if (dayTop) {
                                const holidayLabel = document.createElement('span');
                                holidayLabel.textContent = holiday;
                                holidayLabel.style.cssText = 'color: #e53e3e; font-size: 11px; font-weight: 600; margin-right: 6px;';
                                dayTop.insertBefore(holidayLabel, dayNumber);
                            }
                        }
                        // ì¼ìš”ì¼ (ë¹¨ê°„ìƒ‰)
                        else if (dayOfWeek === 0) {
                            dayNumber.style.color = '#e53e3e';
                            dayNumber.style.fontWeight = '700';
                        }
                        // í† ìš”ì¼ (íŒŒë€ìƒ‰)
                        else if (dayOfWeek === 6) {
                            dayNumber.style.color = '#3182ce';
                            dayNumber.style.fontWeight = '700';
                        }
                    }
                }
            });

            calendar.render();
        }

        async function loadEvents(fetchInfo) {
            try {
                // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
                const filters = getActiveFilters();

                // API URL ìƒì„±
                let url = '/api/intranet/schedules?';
                const params = new URLSearchParams();

                // ë‚ ì§œ ë²”ìœ„ ì¶”ê°€
                if (fetchInfo && fetchInfo.startStr && fetchInfo.endStr) {
                    params.append('startDate', fetchInfo.startStr.split('T')[0]);
                    params.append('endDate', fetchInfo.endStr.split('T')[0]);
                }

                // í•„í„° ì¶”ê°€ (ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ)
                console.log('[ë‹¬ë ¥] í•„í„° ê°’:', filters);
                if (filters.member && filters.member !== '') {
                    params.append('memberId', filters.member);
                } else if (filters.department && filters.department !== '') {
                    params.append('departmentId', filters.department);
                }
                // division í•„í„°ëŠ” ë°±ì—”ë“œì—ì„œ ì§ì ‘ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë¬´ì‹œ

                url += params.toString();

                console.log('[ë‹¬ë ¥] ì¼ì • ì¡°íšŒ URL:', url);

                const response = await fetch(url, {
                    credentials: 'include'
                });

                console.log('[ë‹¬ë ¥] ì‘ë‹µ ìƒíƒœ:', response.status);

                if (!response.ok) {
                    console.error('[ë‹¬ë ¥] ì¼ì • ì¡°íšŒ ì‹¤íŒ¨:', response.status);
                    return [];
                }

                const schedules = await response.json();
                console.log('[ë‹¬ë ¥] ì¡°íšŒëœ ì¼ì • ê°œìˆ˜:', schedules.length);
                console.log('[ë‹¬ë ¥] ì¡°íšŒëœ ì¼ì •:', schedules);

                if (schedules.length === 0) {
                    console.log('[ë‹¬ë ¥] ì¼ì •ì´ ì—†ì–´ì„œ ë¹ˆ ë°°ì—´ ë°˜í™˜');
                    return [];
                }

                // FullCalendar ì´ë²¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                console.log('[ë‹¬ë ¥] ì´ë²¤íŠ¸ ë³€í™˜ ì‹œì‘');
                const events = schedules.map(schedule => {
                    const event = {
                        id: schedule.id,
                        title: schedule.title,
                        allDay: !schedule.startTime, // ì‹œê°„ ì •ë³´ê°€ ì—†ìœ¼ë©´ ì¢…ì¼ ì´ë²¤íŠ¸
                        extendedProps: {
                            scheduleType: schedule.scheduleType,
                            description: schedule.description,
                            status: schedule.status,
                            documentId: schedule.documentId,
                            daysUsed: schedule.daysUsed,
                            startTime: schedule.startTime,
                            endTime: schedule.endTime,
                            memberName: schedule.memberName,
                            departmentName: schedule.departmentName
                        }
                    };

                    // ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
                    const formatDate = (dateValue) => {
                        if (!dateValue) return null;
                        // ì´ë¯¸ ë¬¸ìì—´ í˜•ì‹ì¸ ê²½ìš° (YYYY-MM-DD)
                        if (typeof dateValue === 'string' && dateValue.match(/^\d{4}-\d{2}-\d{2}/)) {
                            return dateValue.split('T')[0];
                        }
                        // Date ê°ì²´ë‚˜ íƒ€ì„ìŠ¤íƒ¬í”„ì¸ ê²½ìš°
                        const d = new Date(dateValue);
                        return d.toISOString().split('T')[0];
                    };

                    const startDateStr = formatDate(schedule.startDate);
                    const endDateStr = formatDate(schedule.endDate);

                    // ì‹œì‘ì¼/ì¢…ë£Œì¼ ì„¤ì •
                    if (schedule.startTime && schedule.endTime) {
                        // ì‹œê°„ ì •ë³´ê°€ ìˆìœ¼ë©´ ë‚ ì§œ+ì‹œê°„ í˜•ì‹ìœ¼ë¡œ
                        event.start = `${startDateStr}T${schedule.startTime}:00`;
                        event.end = `${endDateStr}T${schedule.endTime}:00`;
                    } else {
                        // ì‹œê°„ ì •ë³´ê°€ ì—†ìœ¼ë©´ ë‚ ì§œë§Œ (ì¢…ì¼ ì´ë²¤íŠ¸)
                        event.start = startDateStr;
                        // FullCalendarëŠ” ì¢…ì¼ ì´ë²¤íŠ¸ì˜ ì¢…ë£Œì¼ì„ exclusiveë¡œ ì²˜ë¦¬í•˜ë¯€ë¡œ +1ì¼
                        const endDate = new Date(endDateStr);
                        endDate.setDate(endDate.getDate() + 1);
                        event.end = endDate.toISOString().split('T')[0];
                    }

                    // ì¼ì • ìœ í˜•ë³„ ìƒ‰ìƒ
                    switch (schedule.scheduleType) {
                        case 'VACATION':
                            event.backgroundColor = '#ec4899';
                            event.borderColor = '#ec4899';
                            event.className = 'event-vacation';
                            break;
                        case 'HALF_DAY':
                            event.backgroundColor = '#8b5cf6';
                            event.borderColor = '#8b5cf6';
                            event.className = 'event-half-day';
                            break;
                        case 'BUSINESS_TRIP':
                            event.backgroundColor = '#3b82f6';
                            event.borderColor = '#3b82f6';
                            event.className = 'event-business';
                            break;
                        case 'MEETING':
                            event.backgroundColor = '#10b981';
                            event.borderColor = '#10b981';
                            event.className = 'event-meeting';
                            break;
                        default:
                            event.backgroundColor = '#6b7280';
                            event.borderColor = '#6b7280';
                    }

                    // ì œëª© í¬ë§· (ì•„ì´ì½˜ ë¨¼ì €)
                    let displayTitle = '';
                    if (schedule.scheduleType === 'VACATION') {
                        // ì—°ì°¨: ğŸŒ´ ì—°ì°¨ ì´ë¦„
                        displayTitle = `ğŸŒ´ ì—°ì°¨ ${schedule.memberName || ''}`;
                    } else if (schedule.scheduleType === 'HALF_DAY') {
                        // ë°˜ì°¨: â° ë°˜ì°¨ ì´ë¦„
                        displayTitle = `â° ë°˜ì°¨ ${schedule.memberName || ''}`;
                    } else if (schedule.scheduleType === 'MEETING') {
                        // íšŒì˜: ğŸ“„ ì œëª© (ì´ë¦„)
                        displayTitle = `ğŸ“„ ${schedule.title}`;
                        if (schedule.memberName) {
                            displayTitle += ` (${schedule.memberName})`;
                        }
                    } else if (schedule.scheduleType === 'BUSINESS_TRIP') {
                        // ì¶œì¥: ğŸ’¼ ì œëª© (ì´ë¦„)
                        displayTitle = `ğŸ’¼ ${schedule.title}`;
                        if (schedule.memberName) {
                            displayTitle += ` (${schedule.memberName})`;
                        }
                    } else {
                        displayTitle = schedule.title;
                        if (schedule.memberName) {
                            displayTitle += ` (${schedule.memberName})`;
                        }
                    }

                    event.title = displayTitle;

                    console.log('[ë‹¬ë ¥] ë³€í™˜ëœ ì´ë²¤íŠ¸:', event);
                    return event;
                });

                console.log('[ë‹¬ë ¥] ìµœì¢… ë°˜í™˜í•  ì´ë²¤íŠ¸ ëª©ë¡:', events);
                return events;

            } catch (error) {
                console.error('[ë‹¬ë ¥] ì¼ì • ë¡œë“œ ì˜¤ë¥˜:', error);
                return [];
            }
        }

        async function openEventModal(startDate = null, endDate = null, startTime = null, endTime = null) {
            const modal = document.getElementById('eventModal');
            modal.classList.add('show');

            // ëª¨ë‹¬ ì œëª©ì„ "ì¼ì • ì¶”ê°€"ë¡œ ì„¤ì •
            document.getElementById('modalHeaderTitle').textContent = 'ì¼ì • ì¶”ê°€';

            // ê²°ì¬ ìƒíƒœ ì˜ì—­ ìˆ¨ê¸°ê¸°
            document.getElementById('approvalStatusSection').style.display = 'none';

            if (startDate) {
                document.getElementById('eventStartDate').value = startDate;

                if (endDate) {
                    // select ì½œë°±ì—ì„œ ì´ë¯¸ ë‚ ì§œ ë³€í™˜ì´ ì™„ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
                    document.getElementById('eventEndDate').value = endDate;
                } else {
                    document.getElementById('eventEndDate').value = startDate;
                }
            }

            // ì‹œê°„ ì •ë³´ê°€ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ì„¤ì • (ì£¼ íƒ­ì—ì„œ ë“œë˜ê·¸í•œ ê²½ìš°)
            if (startTime && endTime) {
                // íšŒì˜ ìœ í˜•ìœ¼ë¡œ ìë™ ì„¤ì •
                document.getElementById('eventType').value = 'MEETING';
                await handleEventTypeChange();

                // ì‹œê°„ ì…ë ¥
                document.getElementById('eventStartTime').value = startTime;
                document.getElementById('eventEndTime').value = endTime;
            } else {
                // ìœ í˜• ë³€ê²½ í•¸ë“¤ëŸ¬ ì´ˆê¸°í™”
                await handleEventTypeChange();
            }
        }

        function closeEventModal() {
            document.getElementById('eventModal').classList.remove('show');
            document.getElementById('eventForm').reset();
            // ìˆ¨ê²¨ì§„ í•„ë“œë“¤ ì´ˆê¸°í™”
            document.getElementById('timeGroup').style.display = 'none';
            document.getElementById('halfDayTypeGroup').style.display = 'none';
            document.getElementById('daysUsedGroup').style.display = 'none';
            document.getElementById('approverGroup').style.display = 'none';
            // ì‚­ì œ ë²„íŠ¼ ë° ì·¨ì†Œ ì‹ ì²­ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            document.getElementById('btnDeleteEvent').style.display = 'none';
            document.getElementById('btnCancelRequest').style.display = 'none';
            // í¼ ì œì¶œ ì´ë²¤íŠ¸ ì´ˆê¸°í™” (ê¸°ë³¸ ì €ì¥ ë™ì‘ìœ¼ë¡œ)
            document.getElementById('eventForm').onsubmit = null;
        }

        // ì´ë²¤íŠ¸ ìƒì„¸ ë³´ê¸° (ìˆ˜ì • ëª¨ë“œ)
        async function showEventDetail(event) {
            const scheduleId = event.id;
            console.log('ì¼ì • ID:', scheduleId);

            try {
                // APIì—ì„œ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`/api/intranet/schedules/${scheduleId}`, {
                    credentials: 'include'
                });

                console.log('ì‘ë‹µ ìƒíƒœ:', response.status);

                if (!response.ok) {
                    const errorData = await response.text();
                    console.error('API ì—ëŸ¬:', errorData);
                    alert(`ì¼ì • ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (${response.status})`);
                    return;
                }

                const schedule = await response.json();
                console.log('ì¡°íšŒëœ ì¼ì • ë°ì´í„°:', schedule);

                // ëª¨ë‹¬ ì—´ê¸° (ìˆ˜ì • ëª¨ë“œ)
                const modal = document.getElementById('eventModal');
                modal.classList.add('show');

                // ëª¨ë‹¬ ì œëª© ë³€ê²½
                document.getElementById('modalHeaderTitle').textContent = 'ì¼ì • ìˆ˜ì •';

                // í¼ ë°ì´í„° ì±„ìš°ê¸°
                document.getElementById('eventType').value = schedule.scheduleType;
                await handleEventTypeChange();

                document.getElementById('eventTitle').value = schedule.title || '';
                document.getElementById('eventDescription').value = schedule.description || '';

                // ë‚ ì§œ ì„¤ì •
                const formatDate = (dateValue) => {
                    if (!dateValue) return '';
                    if (typeof dateValue === 'string' && dateValue.match(/^\d{4}-\d{2}-\d{2}/)) {
                        return dateValue.split('T')[0];
                    }
                    const d = new Date(dateValue);
                    return d.toISOString().split('T')[0];
                };

                document.getElementById('eventStartDate').value = formatDate(schedule.startDate);
                document.getElementById('eventEndDate').value = formatDate(schedule.endDate);

                if (schedule.startTime) {
                    document.getElementById('eventStartTime').value = schedule.startTime;
                }
                if (schedule.endTime) {
                    document.getElementById('eventEndTime').value = schedule.endTime;
                }

                if (schedule.daysUsed) {
                    document.getElementById('eventDaysUsed').value = schedule.daysUsed;
                }

                // ì‚­ì œ/ì·¨ì†Œ ì‹ ì²­ ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ ê²°ì •
                const deleteBtn = document.getElementById('btnDeleteEvent');
                const cancelRequestBtn = document.getElementById('btnCancelRequest');
                const isVacationOrHalfDay = schedule.scheduleType === 'VACATION' || schedule.scheduleType === 'HALF_DAY';

                // íšŒì˜/ì¶œì¥: ì–¸ì œë“ ì§€ ì‚­ì œ ê°€ëŠ¥
                // ì—°ì°¨/ë°˜ì°¨: ê²°ì¬ ì „(DRAFT/null) ë˜ëŠ” ë°˜ë ¤(REJECTED)ëœ ê²½ìš°ë§Œ ì‚­ì œ ê°€ëŠ¥
                // ì—°ì°¨/ë°˜ì°¨: ìŠ¹ì¸(APPROVED)ëœ ê²½ìš° ì·¨ì†Œ ì‹ ì²­ ê°€ëŠ¥

                if (isVacationOrHalfDay) {
                    // ì—°ì°¨/ë°˜ì°¨ì¸ ê²½ìš°
                    if (schedule.status === 'APPROVED') {
                        // ìŠ¹ì¸ëœ ì—°ì°¨/ë°˜ì°¨: ì·¨ì†Œ ì‹ ì²­ ë²„íŠ¼ í‘œì‹œ
                        deleteBtn.style.display = 'none';
                        cancelRequestBtn.style.display = 'inline-block';
                        cancelRequestBtn.onclick = async () => {
                            if (confirm('ì´ ì¼ì •ì— ëŒ€í•œ ì·¨ì†Œë¥¼ ì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê²°ì¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.')) {
                                await requestCancellation(scheduleId);
                            }
                        };
                    } else if (!schedule.status || schedule.status === 'DRAFT' || schedule.status === 'REJECTED') {
                        // ê²°ì¬ ì „ ë˜ëŠ” ë°˜ë ¤ëœ ì—°ì°¨/ë°˜ì°¨: ì‚­ì œ ê°€ëŠ¥
                        deleteBtn.style.display = 'inline-block';
                        cancelRequestBtn.style.display = 'none';
                        deleteBtn.onclick = () => {
                            if (confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                deleteSchedule(scheduleId);
                            }
                        };
                    } else {
                        // ì§„í–‰ì¤‘(PENDING): ì‚­ì œ/ì·¨ì†Œ ë¶ˆê°€
                        deleteBtn.style.display = 'none';
                        cancelRequestBtn.style.display = 'none';
                    }
                } else {
                    // íšŒì˜/ì¶œì¥: ì–¸ì œë“ ì§€ ì‚­ì œ ê°€ëŠ¥
                    deleteBtn.style.display = 'inline-block';
                    cancelRequestBtn.style.display = 'none';
                    deleteBtn.onclick = () => {
                        if (confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            deleteSchedule(scheduleId);
                        }
                    };
                }

                // ì €ì¥ ë²„íŠ¼ì„ ìˆ˜ì • ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
                const form = document.getElementById('eventForm');
                const submitBtn = form.querySelector('button[type="submit"]');

                // ìˆ˜ì • ê°€ëŠ¥ ì—¬ë¶€ íŒë‹¨:
                // - íšŒì˜/ì¶œì¥: í•­ìƒ ìˆ˜ì • ê°€ëŠ¥
                // - ì—°ì°¨/ë°˜ì°¨: DRAFT, null, REJECTED ìƒíƒœë§Œ ìˆ˜ì • ê°€ëŠ¥
                //            PENDING/SUBMITTED(ì§„í–‰ì¤‘), APPROVED(ìŠ¹ì¸ì™„ë£Œ)ëŠ” ìˆ˜ì • ë¶ˆê°€
                let canEdit = true;
                let disabledReason = '';

                if (isVacationOrHalfDay) {
                    if (schedule.status === 'PENDING' || schedule.status === 'SUBMITTED') {
                        canEdit = false;
                        disabledReason = 'ê²°ì¬ ì§„í–‰ ì¤‘ (ìˆ˜ì • ë¶ˆê°€)';
                    } else if (schedule.status === 'APPROVED') {
                        canEdit = false;
                        disabledReason = 'ìŠ¹ì¸ ì™„ë£Œ (ìˆ˜ì • ë¶ˆê°€)';
                    } else {
                        // DRAFT, null, REJECTEDëŠ” ìˆ˜ì • ê°€ëŠ¥
                        canEdit = true;
                    }
                }

                if (canEdit) {
                    submitBtn.textContent = 'ìˆ˜ì •';
                    submitBtn.disabled = false;
                    submitBtn.style.background = '';
                    submitBtn.style.cursor = '';
                    // ëª¨ë“  ì…ë ¥ í•„ë“œ í™œì„±í™”
                    form.querySelectorAll('input, select, textarea').forEach(field => {
                        field.disabled = false;
                    });
                    form.onsubmit = async (e) => {
                        e.preventDefault();
                        await updateSchedule(scheduleId);
                    };
                } else {
                    submitBtn.textContent = disabledReason;
                    submitBtn.disabled = true;
                    submitBtn.style.background = '#cbd5e0';
                    submitBtn.style.cursor = 'not-allowed';
                    // ëª¨ë“  ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
                    form.querySelectorAll('input, select, textarea').forEach(field => {
                        field.disabled = true;
                    });
                }

                // ê²°ì¬ ìƒíƒœ í‘œì‹œ (ì—°ì°¨/ë°˜ì°¨ì´ê³  documentIdê°€ ìˆëŠ” ê²½ìš°)
                const statusSection = document.getElementById('approvalStatusSection');
                const statusContent = document.getElementById('approvalStatusContent');

                console.log('ê²°ì¬ ìƒíƒœ í‘œì‹œ ì²´í¬:', {
                    isVacationOrHalfDay,
                    documentId: schedule.documentId,
                    scheduleType: schedule.scheduleType
                });

                if (isVacationOrHalfDay && schedule.documentId) {
                    console.log('ê²°ì¬ ìƒíƒœ ì¡°íšŒ ì‹œì‘:', schedule.documentId);
                    try {
                        const docResponse = await fetch(`/api/intranet/approvals/document/${schedule.documentId}`, {
                            credentials: 'include'
                        });
                        console.log('ê²°ì¬ API ì‘ë‹µ ìƒíƒœ:', docResponse.status, docResponse.ok);

                        if (docResponse.ok) {
                            const approvalData = await docResponse.json();
                            console.log('ê²°ì¬ ë°ì´í„°:', approvalData);

                            // APIëŠ” ë°°ì—´ì„ ì§ì ‘ ë°˜í™˜í•¨
                            if (Array.isArray(approvalData) && approvalData.length > 0) {
                                console.log('ê²°ì¬ ì •ë³´ í‘œì‹œ ì‹œì‘, ê²°ì¬ì ìˆ˜:', approvalData.length);
                                const getDecisionBadge = (decision) => {
                                    const badges = {
                                        'PENDING': '<span style="padding: 4px 8px; background: #edf2f7; color: #718096; border-radius: 4px; font-size: 12px; font-weight: 600;">â³ ëŒ€ê¸°ì¤‘</span>',
                                        'APPROVED': '<span style="padding: 4px 8px; background: #c6f6d5; color: #22543d; border-radius: 4px; font-size: 12px; font-weight: 600;">âœ“ ìŠ¹ì¸</span>',
                                        'REJECTED': '<span style="padding: 4px 8px; background: #fed7d7; color: #742a2a; border-radius: 4px; font-size: 12px; font-weight: 600;">âœ— ë°˜ë ¤</span>'
                                    };
                                    return badges[decision] || badges['PENDING'];
                                };

                                const getDateText = (date) => {
                                    if (!date) return '';
                                    const d = new Date(date);
                                    return `${d.getMonth() + 1}/${d.getDate()} ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`;
                                };

                                statusContent.innerHTML = approvalData.map((approval, index) => {
                                    const comment = approval.approvalComment ? `<div style="font-size: 11px; color: #718096; margin-top: 4px;">ğŸ’¬ ${approval.approvalComment}</div>` : '';
                                    const dateText = approval.decidedAt ? `<div style="font-size: 11px; color: #a0aec0; margin-top: 2px;">${getDateText(approval.decidedAt)}</div>` : '';
                                    return `
                                        <div style="padding: 10px 0; ${index < approvalData.length - 1 ? 'border-bottom: 1px solid #e2e8f0;' : ''}">
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <div>
                                                    <div style="font-size: 13px; color: #2d3748; font-weight: 600;">${index + 1}ë‹¨ê³„: ${approval.approverName} ${approval.approverPosition || ''}</div>
                                                    ${dateText}
                                                </div>
                                                ${getDecisionBadge(approval.decision)}
                                            </div>
                                            ${comment}
                                        </div>
                                    `;
                                }).join('');

                                statusSection.style.display = 'block';
                                console.log('ê²°ì¬ ìƒíƒœ ì„¹ì…˜ í‘œì‹œ ì™„ë£Œ');
                            } else {
                                console.log('ê²°ì¬ ë°ì´í„° ì—†ìŒ ë˜ëŠ” ì¡°ê±´ ë¶ˆë§Œì¡±:', approvalData);
                                statusSection.style.display = 'none';
                            }
                        } else {
                            console.log('ê²°ì¬ API ì‘ë‹µ ì‹¤íŒ¨:', docResponse.status);
                            statusSection.style.display = 'none';
                        }
                    } catch (error) {
                        console.error('ê²°ì¬ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨:', error);
                        statusSection.style.display = 'none';
                    }
                } else {
                    console.log('ê²°ì¬ ìƒíƒœ í‘œì‹œ ì¡°ê±´ ë¶ˆë§Œì¡±');
                    statusSection.style.display = 'none';
                }

            } catch (error) {
                console.error('ì¼ì • ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜ ìƒì„¸:', error.message, error.stack);
                alert('ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì¼ì • ìˆ˜ì •
        async function updateSchedule(scheduleId) {
            const eventData = {
                scheduleType: document.getElementById('eventType').value,
                title: document.getElementById('eventTitle').value,
                description: document.getElementById('eventDescription').value,
                startDate: document.getElementById('eventStartDate').value,
                endDate: document.getElementById('eventEndDate').value,
                status: 'DRAFT'
            };

            const type = eventData.scheduleType;

            if (type === 'MEETING' || type === 'BUSINESS_TRIP') {
                eventData.startTime = document.getElementById('eventStartTime').value;
                eventData.endTime = document.getElementById('eventEndTime').value;
            }

            if (type === 'VACATION' || type === 'HALF_DAY') {
                eventData.daysUsed = parseFloat(document.getElementById('eventDaysUsed').value) || 0;
            }

            try {
                const response = await fetch(`/api/intranet/schedules/${scheduleId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(eventData),
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert('ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    closeEventModal();
                    calendar.refetchEvents();
                    loadSidebarData();
                } else {
                    alert(data.message || 'ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ìˆ˜ì • ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }

        // ì¼ì • ì‚­ì œ
        async function deleteSchedule(scheduleId) {
            try {
                const response = await fetch(`/api/intranet/schedules/${scheduleId}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert('ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeEventModal();
                    calendar.refetchEvents();
                    loadSidebarData();
                } else {
                    alert(data.message || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¼ì • ì·¨ì†Œ ì‹ ì²­ (ìŠ¹ì¸ëœ ì—°ì°¨/ë°˜ì°¨)
        async function requestCancellation(scheduleId) {
            try {
                const response = await fetch(`/api/intranet/schedules/${scheduleId}/cancel`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    alert('ì·¨ì†Œ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nê²°ì¬ í›„ ì·¨ì†Œë©ë‹ˆë‹¤.');
                    closeEventModal();
                    calendar.refetchEvents();
                    loadSidebarData();
                } else {
                    alert(data.message || 'ì·¨ì†Œ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì·¨ì†Œ ì‹ ì²­ ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¼ì • ìœ í˜• ë³€ê²½ í•¸ë“¤ëŸ¬
        async function handleEventTypeChange() {
            const type = document.getElementById('eventType').value;
            const timeGroup = document.getElementById('timeGroup');
            const halfDayTypeGroup = document.getElementById('halfDayTypeGroup');
            const daysUsedGroup = document.getElementById('daysUsedGroup');
            const approverGroup = document.getElementById('approverGroup');
            const startDateInput = document.getElementById('eventStartDate');
            const endDateInput = document.getElementById('eventEndDate');
            const submitBtn = document.querySelector('.modal-footer .btn-success');

            // ëª¨ë“  ì¶”ê°€ í•„ë“œ ì´ˆê¸° ìˆ¨ê¹€
            timeGroup.style.display = 'none';
            halfDayTypeGroup.style.display = 'none';
            daysUsedGroup.style.display = 'none';
            approverGroup.style.display = 'none';

            if (type === 'MEETING' || type === 'BUSINESS_TRIP') {
                // íšŒì˜ë‚˜ ì¶œì¥: ì‹œê°„ ì…ë ¥ í‘œì‹œ
                timeGroup.style.display = 'flex';

                if (type === 'MEETING') {
                    // íšŒì˜ëŠ” ê¸°ë³¸ ì‹œê°„ ì„¤ì •
                    document.getElementById('eventStartTime').value = '14:00';
                    document.getElementById('eventEndTime').value = '16:00';
                }

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ "ì €ì¥"ìœ¼ë¡œ ë³€ê²½
                submitBtn.textContent = 'ì €ì¥';
            } else if (type === 'HALF_DAY') {
                // ë°˜ì°¨: ì˜¤ì „/ì˜¤í›„ ì„ íƒ í‘œì‹œ
                halfDayTypeGroup.style.display = 'block';
                daysUsedGroup.style.display = 'block';
                document.getElementById('eventDaysUsed').value = '0.5';

                // ë°˜ì°¨ëŠ” ë‹¹ì¼ë§Œ
                if (startDateInput.value) {
                    endDateInput.value = startDateInput.value;
                }

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ "ì €ì¥ ë° ê²°ì¬ìš”ì²­"ìœ¼ë¡œ ë³€ê²½
                submitBtn.textContent = 'ì €ì¥ ë° ê²°ì¬ìš”ì²­';

                // ê²°ì¬ì ì •ë³´ í‘œì‹œ
                approverGroup.style.display = 'block';
                await loadApproverInfo();
            } else if (type === 'VACATION') {
                // ì—°ì°¨: ì‚¬ìš© ì¼ìˆ˜ í‘œì‹œ
                daysUsedGroup.style.display = 'block';

                // ì¼ìˆ˜ ìë™ ê³„ì‚°
                if (startDateInput.value && endDateInput.value) {
                    const days = calculateDaysBetween(startDateInput.value, endDateInput.value);
                    document.getElementById('eventDaysUsed').value = days;
                }

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ "ì €ì¥ ë° ê²°ì¬ìš”ì²­"ìœ¼ë¡œ ë³€ê²½
                submitBtn.textContent = 'ì €ì¥ ë° ê²°ì¬ìš”ì²­';

                // ê²°ì¬ì ì •ë³´ í‘œì‹œ
                approverGroup.style.display = 'block';
                await loadApproverInfo();
            }
        }

        // ê²°ì¬ì ì •ë³´ ë¡œë“œ
        async function loadApproverInfo() {
            try {
                // ê²°ì¬ì ëª©ë¡ ì¡°íšŒ
                const [approverResponse, approversResponse] = await Promise.all([
                    fetch('/api/intranet/auth/approver', { credentials: 'include' }),
                    fetch('/api/intranet/auth/approvers', { credentials: 'include' })
                ]);

                if (!approversResponse.ok) {
                    console.error('ê²°ì¬ì ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', approversResponse.status);
                    return;
                }

                const approversData = await approversResponse.json();
                const approverSelect = document.getElementById('approverId');

                // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
                approverSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';

                // ê²°ì¬ì ëª©ë¡ì„ ë“œë¡­ë‹¤ìš´ì— ì¶”ê°€
                if (approversData.success && approversData.approvers) {
                    approversData.approvers.forEach(approver => {
                        const option = document.createElement('option');
                        option.value = approver.id;
                        option.textContent = `${approver.name} (${approver.position} Â· ${approver.departmentName})`;
                        approverSelect.appendChild(option);
                    });
                }

                // ê¸°ë³¸ ê²°ì¬ì ì„¤ì •
                if (approverResponse.ok) {
                    const approverData = await approverResponse.json();
                    if (approverData.success && approverData.approver && approverData.approver.id) {
                        approverSelect.value = approverData.approver.id;
                    }
                }

            } catch (error) {
                console.error('ê²°ì¬ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì‹œì‘ì¼ ë³€ê²½ í•¸ë“¤ëŸ¬
        function handleStartDateChange() {
            const type = document.getElementById('eventType').value;
            const startDate = document.getElementById('eventStartDate').value;
            const endDateInput = document.getElementById('eventEndDate');

            if (!startDate) return;

            // ë°˜ì°¨ëŠ” ë¬´ì¡°ê±´ ë‹¹ì¼
            if (type === 'HALF_DAY') {
                endDateInput.value = startDate;
            } else {
                // ì¢…ë£Œì¼ì´ ë¹„ì–´ìˆê±°ë‚˜ ì‹œì‘ì¼ë³´ë‹¤ ì´ì „ì´ë©´ ìë™ ì„¤ì •
                if (!endDateInput.value || endDateInput.value < startDate) {
                    endDateInput.value = startDate;
                }
            }

            // ì—°ì°¨ì¼ ê²½ìš° ì‚¬ìš© ì¼ìˆ˜ ìë™ ê³„ì‚°
            if (type === 'VACATION' && endDateInput.value) {
                const days = calculateDaysBetween(startDate, endDateInput.value);
                document.getElementById('eventDaysUsed').value = days;
            }
        }

        // ë‚ ì§œ ê°„ ì¼ìˆ˜ ê³„ì‚° (ì£¼ë§ ë° ê³µíœ´ì¼ ì œì™¸)
        function calculateDaysBetween(startDate, endDate) {
            // ì‹œê°„ëŒ€ ë¬¸ì œ ë°©ì§€: YYYY-MM-DD í˜•ì‹ì„ ì§ì ‘ íŒŒì‹±
            const [startYear, startMonth, startDay] = startDate.split('-').map(Number);
            const [endYear, endMonth, endDay] = endDate.split('-').map(Number);

            const start = new Date(startYear, startMonth - 1, startDay);
            const end = new Date(endYear, endMonth - 1, endDay);
            let days = 0;

            // ì‹œì‘ì¼ë¶€í„° ì¢…ë£Œì¼ê¹Œì§€ ìˆœíšŒ (ì¢…ë£Œì¼ í¬í•¨)
            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                const dayOfWeek = d.getDay();
                const holiday = isHoliday(d);

                // ì£¼ë§ ë° ê³µíœ´ì¼ ì œì™¸ (0: ì¼ìš”ì¼, 6: í† ìš”ì¼)
                if (dayOfWeek !== 0 && dayOfWeek !== 6 && !holiday) {
                    days++;
                }
            }

            return days;
        }

        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const type = document.getElementById('eventType').value;
            const eventData = {
                scheduleType: type,
                title: document.getElementById('eventTitle').value,
                startDate: document.getElementById('eventStartDate').value,
                endDate: document.getElementById('eventEndDate').value,
                description: document.getElementById('eventDescription').value,
                startTime: document.getElementById('eventStartTime').value || null,
                endTime: document.getElementById('eventEndTime').value || null,
                daysUsed: document.getElementById('eventDaysUsed').value || 0
            };

            // ì—°ì°¨/ë°˜ì°¨ì¸ ê²½ìš° ê²°ì¬ì ID ì¶”ê°€
            if (type === 'VACATION' || type === 'HALF_DAY') {
                const approverId = document.getElementById('approverId').value;
                if (!approverId) {
                    alert('ê²°ì¬ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                    return;
                }
                eventData.approverId = approverId;
            }

            // ë°˜ì°¨ì¸ ê²½ìš° ì˜¤ì „/ì˜¤í›„ ì •ë³´ ì¶”ê°€
            if (type === 'HALF_DAY') {
                const halfDayType = document.getElementById('halfDayType').value;
                eventData.startTime = halfDayType === 'AM' ? '09:00' : '13:00';
                eventData.endTime = halfDayType === 'AM' ? '13:00' : '18:00';
                eventData.title = `${eventData.title} (${halfDayType === 'AM' ? 'ì˜¤ì „' : 'ì˜¤í›„'}ë°˜ì°¨)`;
            }

            try {
                // schedules_intranetì— ì €ì¥ ë° ê²°ì¬ ìš”ì²­
                const response = await fetch('/api/intranet/schedules', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(eventData)
                });

                const data = await response.json();

                if (data.success) {
                    // íšŒì˜/ì¶œì¥ì€ ê²°ì¬ ë¶ˆí•„ìš”, ì—°ì°¨/ë°˜ì°¨ë§Œ ê²°ì¬ í•„ìš”
                    if (type === 'VACATION' || type === 'HALF_DAY') {
                        alert('ì¼ì •ì´ ì €ì¥ë˜ê³  ê²°ì¬ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        alert('ì¼ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    }
                    closeEventModal();
                    calendar.refetchEvents();
                    loadSidebarData(); // ì‚¬ì´ë“œë°” ë°ì´í„°ë„ ìƒˆë¡œê³ ì¹¨
                } else {
                    alert(data.message || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        });

        async function logout() {
            if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                await fetch('/api/intranet/auth/logout', { method: 'POST' });
            } finally {
                sessionStorage.removeItem('user');
                window.location.href = '/intranet-login.html';
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.getElementById('eventModal').addEventListener('click', (e) => {
            if (e.target.id === 'eventModal') {
                closeEventModal();
            }
        });

        // ì‚¬ì´ë“œë°” ë°ì´í„° ë¡œë“œ
        async function loadSidebarData() {
            await Promise.all([
                loadDepartments(),
                loadLeaveBalance(),
                loadPendingApprovals(),
                loadMySchedules()
            ]);
        }

        // ì „ì—­ ë³€ìˆ˜ë¡œ ë¶€ì„œ ë°ì´í„° ì €ì¥
        let allDepartments = [];

        // ë¶€ì„œ ëª©ë¡ ë¡œë“œ (ì´ˆê¸° ë¡œë“œ)
        async function loadDepartments() {
            try {
                const response = await fetch('/api/intranet/departments/active');
                const data = await response.json();

                if (data.success) {
                    allDepartments = data.departments;

                    // ë³¸ë¶€ ëª©ë¡ ë¡œë“œ
                    loadDivisions();

                    // ì €ì¥ëœ í•„í„° ë³µì› ì‹œë„
                    const restored = await restoreSavedFilters();

                    // ì €ì¥ëœ í•„í„°ê°€ ì—†ìœ¼ë©´ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê¸°ë°˜ìœ¼ë¡œ ê¸°ë³¸ê°’ ì„¤ì •
                    if (!restored) {
                        await setDefaultFilters();
                    }
                }
            } catch (error) {
                console.error('ë¶€ì„œ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // ë³¸ë¶€ ëª©ë¡ ë¡œë“œ (1ë‹¨ê³„)
        function loadDivisions() {
            const divisionSelect = document.getElementById('filterDivision');

            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì „ì²´ ì œì™¸)
            while (divisionSelect.options.length > 1) {
                divisionSelect.remove(1);
            }

            // ë³¸ë¶€ë§Œ í•„í„°ë§ (parent_id = 1, id != 1)
            const divisions = allDepartments.filter(d =>
                d.parentId === 1 && d.id !== 1
            ).sort((a, b) => a.displayOrder - b.displayOrder);

            // ë³¸ë¶€ ì¶”ê°€
            divisions.forEach(division => {
                const option = document.createElement('option');
                option.value = division.id;
                option.textContent = division.name;
                divisionSelect.appendChild(option);
            });
        }

        // ë³¸ë¶€ ë³€ê²½ì‹œ ë¶€ì„œ ëª©ë¡ ë¡œë“œ (2ë‹¨ê³„)
        async function handleDivisionChange() {
            console.log('[í•„í„°] handleDivisionChange í˜¸ì¶œë¨');
            const divisionId = document.getElementById('filterDivision').value;
            const deptSelect = document.getElementById('filterDepartment');

            // ë¶€ì„œ ì„ íƒ ì´ˆê¸°í™”
            deptSelect.innerHTML = '<option value="">ì „ì²´</option>';

            // êµ¬ì„±ì› ì„ íƒ ì´ˆê¸°í™”
            document.getElementById('filterMember').innerHTML = '<option value="">ì „ì²´</option>';

            if (divisionId) {
                // ì„ íƒí•œ ë³¸ë¶€ì˜ í•˜ìœ„ ë¶€ì„œ(Unit) ì°¾ê¸°
                const departments = allDepartments.filter(d =>
                    d.parentId == divisionId
                ).sort((a, b) => a.displayOrder - b.displayOrder);

                // ë¶€ì„œ ì¶”ê°€
                departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept.id;
                    option.textContent = dept.name;
                    deptSelect.appendChild(option);
                });
            }

            console.log('[í•„í„°] handleDivisionChange ì™„ë£Œ, applyFilters í˜¸ì¶œ');
            applyFilters();
        }

        // ë¶€ì„œ ë³€ê²½ì‹œ êµ¬ì„±ì› ëª©ë¡ ë¡œë“œ (3ë‹¨ê³„)
        async function handleDepartmentChange() {
            console.log('[í•„í„°] handleDepartmentChange í˜¸ì¶œë¨');
            const departmentId = document.getElementById('filterDepartment').value;
            await loadMembers(departmentId);
            console.log('[í•„í„°] handleDepartmentChange ì™„ë£Œ, applyFilters í˜¸ì¶œ');
            applyFilters();
        }

        // êµ¬ì„±ì› ëª©ë¡ ë¡œë“œ
        async function loadMembers(departmentId = null) {
            try {
                let url = '/api/intranet/members/active';
                if (departmentId) {
                    url = `/api/intranet/members/department/${departmentId}`;
                }

                const response = await fetch(url);
                const members = await response.json();

                const select = document.getElementById('filterMember');

                // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì „ì²´ ì œì™¸)
                while (select.options.length > 1) {
                    select.remove(1);
                }

                // êµ¬ì„±ì› ì¶”ê°€ (ì§ê¸‰ ìˆœì„œë¡œ ì •ë ¬)
                if (Array.isArray(members)) {
                    // ì§ê¸‰ ìš°ì„ ìˆœìœ„ ì •ì˜
                    const positionOrder = {
                        'ë³¸ë¶€ì¥': 1,
                        'ìë¬¸/ì„ì›': 2,
                        'Unitì¥': 3,
                        'ë§¤ë‹ˆì €': 4,
                        'ì‚¬ì›': 5
                    };

                    // ì§ê¸‰ ìˆœìœ¼ë¡œ ì •ë ¬
                    const sortedMembers = members.sort((a, b) => {
                        const orderA = positionOrder[a.position] || 99;
                        const orderB = positionOrder[b.position] || 99;
                        if (orderA !== orderB) {
                            return orderA - orderB;
                        }
                        // ê°™ì€ ì§ê¸‰ì´ë©´ ì´ë¦„ìˆœ
                        return a.name.localeCompare(b.name, 'ko-KR');
                    });

                    sortedMembers.forEach(member => {
                        const option = document.createElement('option');
                        option.value = member.id;
                        option.textContent = `${member.name} (${member.position || ''})`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('êµ¬ì„±ì› ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // íœ´ê°€ í˜„í™© ë¡œë“œ
        async function loadLeaveBalance() {
            try {
                // TODO: ì‹¤ì œ API ì—°ë™
                // ì„ì‹œë¡œ í•˜ë“œì½”ë”©
                document.getElementById('leaveGranted').textContent = '15';
                document.getElementById('leaveUsed').textContent = '2';
                document.getElementById('leaveRemaining').textContent = '13';
            } catch (error) {
                console.error('íœ´ê°€ í˜„í™© ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // ê²°ì¬ ëŒ€ê¸° ëª©ë¡ ë¡œë“œ
        async function loadPendingApprovals() {
            try {
                const response = await fetch('/api/intranet/approvals/pending');
                const data = await response.json();

                const badge = document.getElementById('approvalBadge');
                const list = document.getElementById('approvalList');

                if (!data.success || !data.approvals || data.approvals.length === 0) {
                    badge.textContent = '0';
                    list.innerHTML = '<div style="text-align: center; padding: 20px; color: #a0aec0; font-size: 13px;">ê²°ì¬ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }

                badge.textContent = data.approvals.length;
                list.innerHTML = data.approvals.map(approval => `
                    <div style="padding: 12px; margin-bottom: 8px; background: #f7fafc; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <div style="font-size: 13px; font-weight: 700; color: #2d3748; margin-bottom: 4px;">${approval.document?.title || 'ì œëª© ì—†ìŒ'}</div>
                        <div style="font-size: 11px; color: #718096; margin-bottom: 8px;">${approval.document?.authorName || 'ì•Œ ìˆ˜ ì—†ìŒ'} Â· ${approval.stepOrder}ë‹¨ê³„</div>
                        <div style="display: flex; gap: 6px;">
                            <button onclick="approveFromSidebar(${approval.id})" style="flex: 1; padding: 6px; background: #10b981; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 700; cursor: pointer;">ìŠ¹ì¸</button>
                            <button onclick="rejectFromSidebar(${approval.id})" style="flex: 1; padding: 6px; background: #ef4444; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 700; cursor: pointer;">ë°˜ë ¤</button>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('ê²°ì¬ ëŒ€ê¸° ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // ë‚´ ì¼ì • ëª©ë¡ ë¡œë“œ
        async function loadMySchedules() {
            try {
                // TODO: ì‹¤ì œ API ì—°ë™
                // ì„ì‹œ ë°ì´í„° (ì‹œê°„ ì •ë³´ í¬í•¨)
                const schedules = [
                    {
                        type: 'VACATION',
                        title: 'ì—°ì°¨',
                        startDate: '2026-01-15',
                        endDate: '2026-01-15',
                        status: 'APPROVED'
                    },
                    {
                        type: 'MEETING',
                        title: 'íŒ€ íšŒì˜',
                        startDate: '2026-01-10',
                        endDate: '2026-01-10',
                        startTime: '14:00',
                        endTime: '16:00',
                        status: 'APPROVED'
                    }
                ];

                const list = document.getElementById('myScheduleList');

                if (schedules.length === 0) {
                    list.innerHTML = '<div style="text-align: center; padding: 20px; color: #a0aec0; font-size: 13px;">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }

                list.innerHTML = schedules.map(schedule => {
                    const colors = {
                        'VACATION': '#ec4899',
                        'HALF_DAY': '#8b5cf6',
                        'BUSINESS_TRIP': '#3b82f6',
                        'MEETING': '#10b981'
                    };

                    let dateText = schedule.startDate;
                    if (schedule.endDate && schedule.endDate !== schedule.startDate) {
                        dateText += ` ~ ${schedule.endDate}`;
                    }

                    // ì‹œê°„ ì •ë³´ê°€ ìˆìœ¼ë©´ ì¶”ê°€
                    if (schedule.startTime) {
                        dateText += ` ${schedule.startTime}`;
                        if (schedule.endTime) {
                            dateText += `-${schedule.endTime}`;
                        }
                    }

                    return `
                        <div style="padding: 10px 12px; margin-bottom: 8px; background: #f7fafc; border-radius: 8px; border-left: 4px solid ${colors[schedule.type]};">
                            <div style="font-size: 13px; font-weight: 700; color: #2d3748; margin-bottom: 4px;">${schedule.title}</div>
                            <div style="font-size: 11px; color: #718096;">${dateText}</div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('ë‚´ ì¼ì • ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ì´ë“œë°”ì—ì„œ ìŠ¹ì¸
        // ì „ì—­ ë³€ìˆ˜: í˜„ì¬ ê²°ì¬ ì •ë³´
        let currentApprovalId = null;
        let currentApprovalAction = null;
        let currentApprovalData = null;

        // ê²°ì¬ ëª¨ë‹¬ ì—´ê¸°
        async function approveFromSidebar(approvalId) {
            await openApprovalModal(approvalId, 'approve');
        }

        // ì‚¬ì´ë“œë°”ì—ì„œ ë°˜ë ¤
        async function rejectFromSidebar(approvalId) {
            await openApprovalModal(approvalId, 'reject');
        }

        // ê²°ì¬ ëª¨ë‹¬ ì—´ê¸° (ìƒì„¸ ì •ë³´ ë¡œë“œ)
        async function openApprovalModal(approvalId, action) {
            try {
                // ê²°ì¬ ìƒì„¸ ì •ë³´ ì¡°íšŒ
                const response = await fetch(`/api/intranet/approvals/pending`);
                const data = await response.json();

                if (!data.success || !data.approvals) {
                    alert('ê²°ì¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }

                const approval = data.approvals.find(a => a.id === approvalId);
                if (!approval) {
                    alert('ê²°ì¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }

                currentApprovalId = approvalId;
                currentApprovalAction = action;
                currentApprovalData = approval;

                // ëª¨ë‹¬ íƒ€ì´í‹€ ë° ë²„íŠ¼ ì„¤ì •
                const modal = document.getElementById('approvalModal');
                const modalTitle = document.getElementById('approvalModalTitle');
                const confirmBtn = document.getElementById('approvalConfirmBtn');

                if (action === 'approve') {
                    modalTitle.textContent = 'ê²°ì¬ ìŠ¹ì¸';
                    confirmBtn.textContent = 'ìŠ¹ì¸';
                    confirmBtn.className = 'btn-modal-approve';
                } else {
                    modalTitle.textContent = 'ê²°ì¬ ë°˜ë ¤';
                    confirmBtn.textContent = 'ë°˜ë ¤';
                    confirmBtn.className = 'btn-modal-reject';
                }

                // ë¬¸ì„œ ì •ë³´ í‘œì‹œ
                document.getElementById('approvalDocTitle').textContent = approval.document?.title || 'ì œëª© ì—†ìŒ';
                document.getElementById('approvalDocAuthor').textContent = approval.document?.authorName || 'ì•Œ ìˆ˜ ì—†ìŒ';
                document.getElementById('approvalDocDate').textContent = formatDateTime(approval.document?.createdAt || approval.submittedAt);
                document.getElementById('approvalStep').textContent = `${approval.stepOrder}ë‹¨ê³„`;
                document.getElementById('approvalDocContent').textContent = approval.document?.content || 'ë‚´ìš© ì—†ìŒ';
                document.getElementById('approvalComment').value = '';

                // ëª¨ë‹¬ í‘œì‹œ
                modal.classList.add('show');

            } catch (error) {
                console.error('ê²°ì¬ ëª¨ë‹¬ ì—´ê¸° ì˜¤ë¥˜:', error);
                alert('ê²°ì¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        // ê²°ì¬ ëª¨ë‹¬ ë‹«ê¸°
        function closeApprovalModal() {
            document.getElementById('approvalModal').classList.remove('show');
            currentApprovalId = null;
            currentApprovalAction = null;
            currentApprovalData = null;
        }

        // ê²°ì¬ í™•ì¸ (ìŠ¹ì¸/ë°˜ë ¤)
        async function confirmApproval() {
            if (!currentApprovalId || !currentApprovalAction) return;

            const comment = document.getElementById('approvalComment').value.trim();
            const endpoint = currentApprovalAction === 'approve' ? 'approve' : 'reject';

            // ë°˜ë ¤ ì‹œ ì˜ê²¬ í•„ìˆ˜
            if (currentApprovalAction === 'reject' && !comment) {
                alert('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            try {
                const response = await fetch(`/api/intranet/approvals/${currentApprovalId}/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ comment: comment || '' })
                });

                const data = await response.json();

                if (data.success) {
                    alert(data.message || (currentApprovalAction === 'approve' ? 'ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤' : 'ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤'));
                    closeApprovalModal();
                    loadPendingApprovals();
                    calendar.refetchEvents();
                } else {
                    alert(data.message || 'ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ê²°ì¬ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }

        // ë‚ ì§œ/ì‹œê°„ í¬ë§· í•¨ìˆ˜
        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            console.log('[í•„í„°] applyFilters í˜¸ì¶œë¨');
            // í•„í„° ê°’ì„ ì„¸ì…˜ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            const filters = getActiveFilters();
            console.log('[í•„í„°] í˜„ì¬ í•„í„° ê°’:', filters);
            sessionStorage.setItem('scheduleFilters', JSON.stringify(filters));

            // ìº˜ë¦°ë” ì´ë²¤íŠ¸ ìƒˆë¡œê³ ì¹¨
            if (calendar) {
                console.log('[í•„í„°] calendar.refetchEvents() í˜¸ì¶œ');
                calendar.refetchEvents();
            } else {
                console.error('[í•„í„°] calendar ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤!');
            }
        }

        // ì €ì¥ëœ í•„í„° ë³µì›
        async function restoreSavedFilters() {
            try {
                const savedFilters = sessionStorage.getItem('scheduleFilters');
                if (savedFilters) {
                    const filters = JSON.parse(savedFilters);

                    // ë³¸ë¶€ ì„ íƒ ë³µì›
                    if (filters.division) {
                        document.getElementById('filterDivision').value = filters.division;
                        await handleDivisionChange();
                    }

                    // ë¶€ì„œ ì„ íƒ ë³µì›
                    if (filters.department) {
                        document.getElementById('filterDepartment').value = filters.department;
                        await handleDepartmentChange();
                    }

                    // êµ¬ì„±ì› ì„ íƒ ë³µì›
                    if (filters.member) {
                        document.getElementById('filterMember').value = filters.member;
                    }

                    applyFilters();
                    return true; // ë³µì› ì„±ê³µ
                }
                return false; // ì €ì¥ëœ í•„í„° ì—†ìŒ
            } catch (error) {
                console.error('í•„í„° ë³µì› ì‹¤íŒ¨:', error);
                return false;
            }
        }

        // ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê¸°ë°˜ìœ¼ë¡œ ê¸°ë³¸ê°’ ì„¤ì •
        async function setDefaultFilters() {
            try {
                // ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('/api/intranet/auth/me');
                const data = await response.json();

                if (data.success && data.user) {
                    const userId = data.user.id;

                    // ì‚¬ìš©ì ìƒì„¸ ì •ë³´ ì¡°íšŒ
                    const memberResponse = await fetch(`/api/intranet/members/${userId}`);
                    const member = await memberResponse.json();

                    if (member && member.departmentId) {
                        // ì‚¬ìš©ìì˜ ë¶€ì„œ ì°¾ê¸°
                        const userDepartment = allDepartments.find(d => d.id === member.departmentId);

                        if (userDepartment) {
                            // ìƒìœ„ ë³¸ë¶€ ì°¾ê¸°
                            let divisionId = null;
                            if (userDepartment.parentId === 1) {
                                // ë³¸ì¸ì´ ë³¸ë¶€ ì†Œì†
                                divisionId = userDepartment.id;
                            } else {
                                // Unit ì†Œì†ì´ë©´ ìƒìœ„ ë³¸ë¶€ ì°¾ê¸°
                                const parentDept = allDepartments.find(d => d.id === userDepartment.parentId);
                                if (parentDept && parentDept.parentId === 1) {
                                    divisionId = parentDept.id;
                                }
                            }

                            // ë³¸ë¶€ ì„ íƒ
                            if (divisionId) {
                                document.getElementById('filterDivision').value = divisionId;
                                await handleDivisionChange();

                                // ë¶€ì„œ ì„ íƒ
                                document.getElementById('filterDepartment').value = member.departmentId;
                                await handleDepartmentChange();

                                // êµ¬ì„±ì›ì€ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë¡œ ì„¤ì •
                                document.getElementById('filterMember').value = userId;
                            }
                        }
                    }

                    applyFilters();
                }
            } catch (error) {
                console.error('ê¸°ë³¸ í•„í„° ì„¤ì • ì‹¤íŒ¨:', error);
            }
        }

        // ë‚´ ì¼ì • ë³´ê¸° (ë¡œê·¸ì¸ ì‚¬ìš©ì ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›)
        async function showMySchedule() {
            await setDefaultFilters();
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('filterDivision').value = '';
            document.getElementById('filterDepartment').value = '';
            document.getElementById('filterMember').value = '';

            // ë¶€ì„œ ë° êµ¬ì„±ì› ì„ íƒ ì´ˆê¸°í™”
            document.getElementById('filterDepartment').innerHTML = '<option value="">ì „ì²´</option>';
            document.getElementById('filterMember').innerHTML = '<option value="">ì „ì²´</option>';

            applyFilters();
        }

        // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
        function getActiveFilters() {
            return {
                division: document.getElementById('filterDivision').value,
                department: document.getElementById('filterDepartment').value,
                member: document.getElementById('filterMember').value
            };
        }

        // ì„¸ì…˜ ì²´í¬ ë° ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸
        async function checkSession() {
            try {
                const response = await fetch('/api/intranet/auth/session', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (!response.ok || response.status === 401) {
                    // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    window.location.href = '/intranet-login.html';
                    return false;
                }

                const data = await response.json();
                if (!data.authenticated) {
                    window.location.href = '/intranet-login.html';
                    return false;
                }

                return true;
            } catch (error) {
                console.error('ì„¸ì…˜ ì²´í¬ ì‹¤íŒ¨:', error);
                window.location.href = '/intranet-login.html';
                return false;
            }
        }

        window.addEventListener('load', async () => {
            // ì„¸ì…˜ ì²´í¬ ë¨¼ì € ìˆ˜í–‰
            const isAuthenticated = await checkSession();
            if (!isAuthenticated) {
                return; // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ì—¬ê¸°ì„œ ì¤‘ë‹¨
            }

            displayUserInfo();
            initCalendar();
            await loadSidebarData();
            // êµ¬ì„±ì›ì€ setDefaultFilters()ì—ì„œ ìë™ìœ¼ë¡œ ë¡œë“œë¨
        });
    </script>

    <!-- ê²°ì¬ ìŠ¹ì¸/ë°˜ë ¤ ëª¨ë‹¬ -->
    <div id="approvalModal" class="approval-modal" onclick="if(event.target === this) closeApprovalModal()">
        <div class="approval-modal-content">
            <div class="approval-modal-header" id="approvalModalTitle">ê²°ì¬ ìŠ¹ì¸</div>
            <div class="approval-modal-body">
                <div class="approval-info-row">
                    <div class="approval-info-label">ë¬¸ì„œ ì œëª©</div>
                    <div class="approval-info-value" id="approvalDocTitle">-</div>
                </div>
                <div class="approval-info-row">
                    <div class="approval-info-label">ì‘ì„±ì</div>
                    <div class="approval-info-value" id="approvalDocAuthor">-</div>
                </div>
                <div class="approval-info-row">
                    <div class="approval-info-label">ì‘ì„±ì¼</div>
                    <div class="approval-info-value" id="approvalDocDate">-</div>
                </div>
                <div class="approval-info-row">
                    <div class="approval-info-label">ê²°ì¬ ë‹¨ê³„</div>
                    <div class="approval-info-value" id="approvalStep">-</div>
                </div>

                <div style="margin-top: 20px;">
                    <div style="font-weight: 600; color: #2d3748; margin-bottom: 8px; font-size: 14px;">ë¬¸ì„œ ë‚´ìš©</div>
                    <div class="approval-content-box" id="approvalDocContent">-</div>
                </div>

                <div class="form-group-modal">
                    <label for="approvalComment">ì˜ê²¬ <span style="color: #a0aec0; font-weight: 400;">(ì„ íƒ)</span></label>
                    <textarea id="approvalComment" placeholder="ì˜ê²¬ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
            </div>
            <div class="approval-modal-footer">
                <button class="btn-modal-cancel" onclick="closeApprovalModal()">ì·¨ì†Œ</button>
                <button id="approvalConfirmBtn" class="btn-modal-approve" onclick="confirmApproval()">ìŠ¹ì¸</button>
            </div>
        </div>
    </div>
</body>
</html>
